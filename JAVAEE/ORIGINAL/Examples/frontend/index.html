<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .container {
            margin: 0 auto;
            padding: 20px;
        }
        .text-end {
            padding: 20px;
        }
        .event-card {
            margin-bottom: 20px;
        }
        #eventsContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
    </style>
</head>
<body>
<div class="container" id="customer-content">
    <div id="sec">
        <section>
            <h1 class="h2" id="title"><i class="bi bi-calendar-event me-2"></i>Event Management</h1>

            <form id="eventForm" class="needs-validation" novalidate>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="eventId" name="id" placeholder=" " required>
                            <label for="eventId"><i class="bi bi-tag"></i> Event ID</label>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="eventName" name="ename" placeholder=" ">
                            <label for="eventName"><i class="bi bi-card-heading"></i> Event Name</label>
                        </div>

                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="eventDescription" name="edescription" placeholder=" " style="height: 100px"></textarea>
                            <label for="eventDescription"><i class="bi bi-text-paragraph"></i> Description</label>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-floating mb-3">
                            <input type="date" class="form-control" id="eventDate" name="edate" placeholder=" ">
                            <label for="eventDate"><i class="bi bi-calendar-date"></i> Date</label>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="eventPlace" name="eplace" placeholder=" ">
                            <label for="eventPlace"><i class="bi bi-geo-alt"></i> Location</label>
                        </div>
                    </div>
                </div>

                <div class="action-buttons text-end">
                    <button type="button" class="btn btn-success" id="btnSave">
                        <i class="bi bi-check-circle"></i> Save
                    </button>
                    <button type="button" class="btn btn-danger" id="btnDelete">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                    <button type="button" class="btn btn-info text-white" id="btnUpdate">
                        <i class="bi bi-arrow-counterclockwise"></i> Update
                    </button>
                    <button type="button" class="btn btn-primary" id="btnLoadAll">
                        <i class="bi bi-arrow-repeat"></i> Load All Events
                    </button>
                </div>
            </form>
        </section>

        <section class="mt-5">
            <h3 class="h4 mb-3"><i class="bi bi-list-ul"></i> All Events</h3>
            <div id="eventsContainer" class="row">
                <!-- Events will be loaded here dynamically -->
            </div>
        </section>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    $(document).ready(function () {
        // Load all events when page loads
        loadAllEvents();

        // Button to reload all events
        $("#btnLoadAll").click(function() {
            loadAllEvents();
        });

        function loadAllEvents() {
            $.ajax({
                url: "event",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    displayEvents(data);
                },
                error: function(xhr, status, error) {
                    alert("Error loading events: " + error);
                }
            });
        }

        function displayEvents(events) {
            const container = $("#eventsContainer");
            container.empty(); // Clear existing content

            if (events.length === 0) {
                container.append('<div class="col-12"><p class="text-muted">No events found</p></div>');
                return;
            }

            events.forEach(function(event) {
                const eventCard = `
                    <div class="col-md-4 event-card">
                        <div class="card h-100 border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">${event.ename}</h5>
                                <p class="card-text">${event.edescription}</p>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted"><i class="bi bi-calendar"></i> ${event.edate}</small>
                                    <small class="text-muted"><i class="bi bi-geo-alt"></i> ${event.eplace}</small>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${event.id}">Edit</button>
                                    <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${event.id}">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>`;
                container.append(eventCard);
            });

            // Add click handlers for edit buttons
            $(".edit-btn").click(function() {
                const eventId = $(this).data("id");
                // Find the event in the array and populate the form
                const event = events.find(e => e.id === eventId);
                if (event) {
                    $("#eventId").val(event.id);
                    $("#eventName").val(event.ename);
                    $("#eventDescription").val(event.edescription);
                    $("#eventDate").val(event.edate);
                    $("#eventPlace").val(event.eplace);
                }
            });
        }

        // Save button handler
        $("#btnSave").click(function() {
            const eventData = {
                id: $("#eventId").val(),
                ename: $("#eventName").val(),
                edescription: $("#eventDescription").val(),
                edate: $("#eventDate").val(),
                eplace: $("#eventPlace").val()
            };

            $.ajax({
                url: "event",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(eventData),
                success: function(response) {
                    alert("Event saved successfully!");
                    loadAllEvents();
                    $("#eventForm")[0].reset();
                },
                error: function(xhr, status, error) {
                    alert("Error saving event: " + error);
                }
            });
        });

        // Similar implementations for Update and Delete buttons
        // ...
    });
</script>
</body>
</html>